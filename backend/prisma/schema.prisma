// =========================
//  Prisma Schema - Appointly MVP (UPDATED FINAL)
// =========================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =========================
//  ENUMS
// =========================

enum Role {
  CUSTOMER
  PROVIDER
  ADMIN
}

enum AppointmentStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

// =========================
//  MODELS
// =========================

// USERS - both customers + providers
model User {
  id          String         @id @default(uuid())
  email       String         @unique
  password    String
  fullName    String
  role        Role           @default(CUSTOMER)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  // Relations
  providerProfile BusinessProvider?
  appointments     Appointment[]
}

// PROVIDER PROFILE
model BusinessProvider {
  id            String           @id @default(uuid())
  userId        String           @unique
  businessName  String
  category      String
  phone         String?
  description   String?

  // Location
  address       String?
  city          String?
  district      String?
  latitude      Float?
  longitude     Float?

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  // Relations
  user          User             @relation(fields: [userId], references: [id])
  services      Service[]
  hours         WorkingHours[]
  appointments  Appointment[]
}

// SERVICES OFFERED BY PROVIDERS
model Service {
  id          String        @id @default(uuid())
  providerId  String
  name        String
  duration    Int
  price       Int
  description String?

  provider    BusinessProvider @relation(fields: [providerId], references: [id])
  appointments Appointment[]
}

// DATE-SPECIFIC SCHEDULES
model WorkingHours {
  id           String   @id @default(uuid())
  providerId   String
  date         DateTime
  openTime     String
  closeTime    String

  provider     BusinessProvider @relation(fields: [providerId], references: [id])
}

// APPOINTMENTS
model Appointment {
  id             String             @id @default(uuid())
  customerId     String
  providerId     String
  serviceId      String
  appointmentTime DateTime
  status         AppointmentStatus  @default(PENDING)
  notes          String?

  createdAt      DateTime           @default(now())
  updatedAt      DateTime           @updatedAt

  customer   User             @relation(fields: [customerId], references: [id])
  provider   BusinessProvider @relation(fields: [providerId], references: [id])
  service    Service          @relation(fields: [serviceId], references: [id])
}

// AUDIT LOGS - Track all user actions
model AuditLog {
  id        String   @id @default(uuid())
  userId    String
  action    String   // LOGIN, BOOKING_CREATED, BOOKING_CANCELLED, PROFILE_UPDATED, etc
  entityId  String?  // ID of affected resource (booking ID, profile ID, etc)
  details   Json?    // Additional details about the action
  timestamp DateTime @default(now())

  @@index([userId])
  @@index([timestamp])
  @@index([action])
}
